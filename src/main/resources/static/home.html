<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>图片分享-首页</title>
    <script src="./jQuery/jquery-3.5.1.slim.min.js"></script>
    <script src="./jQuery/jquery-3.5.1.min.js"></script>
    <link rel = "stylesheet" href = "./jQueryUI-1.13.2/jquery-ui.min.css">
    <link rel = "stylesheet" href = "./jQueryUI-1.13.2/jquery-ui.structure.min.css">
    <link rel = "stylesheet" href = "./jQueryUI-1.13.2/jquery-ui.theme.min.css">
    <script src="./jQueryUI-1.13.2/jquery-ui.min.js"></script>
    <style>
        textarea{
            width: 80%;
            position: relative;
            border: 5px solid #007fff;
            padding: 10px 20px 10px 20px;
            margin: 10px 20px 10px 20px;
            text-align: left;
            vertical-align: top;
            font-size: 36px;
            font-family: '隶书';
        }
    </style>
</head>
<body>
<div id="root" style="height: 100%;width: 100%;top: 0;left: 0;position: fixed" class="initial">
    <div id="header" style="height: 6%;width: 99.6%;top: 0.2%;right: 0.2%;position: fixed" class="initial">
        <input type="text" style="width: 18%;height: 100%;float:left;font-size: 36px;text-align: center;" id="name" readonly value="未登录">
        <input type="button" class="ui-button" style="height:100%;float: right;font-size: 36px;text-align: center;" id="chooseTologgout" value="安全退出">
    </div>
    <div id="content" style="height: 89.2%;width: 99.6%;right: 0.2%;top: 6.8%;position: relative;overflow-y: scroll" class="initial">
        <div style="position: relative;border:5px solid #2b2b2b;border-left: 0;border-right: 0; border-bottom: 0;font-size: 48px;
        text-align: center;vertical-align: center;height: 99.6%;width: 99.6%">
            <div id="list" style="width: 100%;height: 5%;position: fixed;">
                <input type="button" class="ui-button" style="height: 100%;width: 13%;text-align: center
                    ;float: left" value="答题" id="answer">
                <input type="button" class="ui-button" style="height: 100%;width: 13%;text-align: center
                    ;float: left" value="上传" id="upload">
                <input type="button" class="ui-button" style="height: 100%;width: 13%;text-align: center
                    ;float: left" value="全部" id="classify_-1">
                <input type="button" class="ui-button" style="height: 100%;width: 13%;text-align: center
                    ;float: left" value="通知" id="notice">
            </div>
            <br>
            <div id="imageslist" style="width: 100%;height: auto;text-align: center">

            </div>
        </div>
    </div>
    <div id="footer" style="height: 3.2%;width: 99.6%;bottom: 0.2%;right: 0.2%;position: fixed" class="initial">
        <div id="uponeimage" style="position: fixed;width: 80%;height: 80%;top: 5%;left: 10%;border: 1px solid #000;z-index: 999;background-color: #FFF;display: none">
            <label style="font-size: 36px;float: left" for="uploadclassify">图片所属分类:</label>
            <select style="font-size: 36px" id="uploadclassify">
                <option value=""></option>
            </select>
            <input type="file" id="uploadimage" accept="image/gif,image/jpeg,image/jpg,image/png,image/svg">
            <input id="sureupload" type="button" class="ui-button" style="height: 36px;width: 15%" value="提交">
            <input id="closeupload" type="button" class="ui-button" style="float: right;height: 36px;width: 10%;
                background-color: #ccc"
                   value="关闭 X"><br>
            <img id="showimage" style="width: auto;height: 80%;" src="" alt="请上传图片">
            <div id="path"></div>
        </div>
        <div id="todoanswer" style="position: fixed;width: 80%;height: 80%;top: 5%;left: 10%;border: 1px solid #000;z-index: 999;background-color: #FFF;display: none">
            <input id="closeanswer" type="button" class="ui-button" style="float: right;height: 36px;width: 10%;
                background-color: #ccc"
                   value="关闭 X"><br>
            <div>
                <span>1.概括一下核聚变的磁约束方式：</span>
                <div><input type="radio" name="selectOne-1" value="0">(A)我知道</div>
                <div><input type="radio" name="selectOne-1" value="1">(B)我不知道</div>
                <div><input type="radio" name="selectOne-1" value="2">(C)我怎么知道</div>
                <div><input type="radio" name="selectOne-1" value="3">(D)我知道才不对劲</div>
            </div>
            <div>
                <span>2.黑洞与白洞的内在联系是：</span>
                <div><input type="radio" name="selectOne-2" value="0">(A)我不知道</div>
                <div><input type="radio" name="selectOne-2" value="1">(B)我肯定不知道</div>
                <div><input type="radio" name="selectOne-2" value="2">(C)我怎么可能知道</div>
                <div><input type="radio" name="selectOne-2" value="3">(D)我知道才不对劲</div>
            </div>
            <div>
                <span>3.时光机是什么时间发明的：</span>
                <div><input type="radio" name="selectOne-3" value="0">(A)我不知道</div>
                <div><input type="radio" name="selectOne-3" value="1">(B)我肯定不知道</div>
                <div><input type="radio" name="selectOne-3" value="2">(C)我怎么可能知道</div>
                <div><input type="radio" name="selectOne-3" value="3">(D)我知道才不对劲</div>
            </div>
            <div>
                <span>4.穿越到异世界的第一件事是什么：</span>
                <div><input type="radio" name="selectOne-4" value="0">(A)我不知道</div>
                <div><input type="radio" name="selectOne-4" value="1">(B)我肯定不知道</div>
                <div><input type="radio" name="selectOne-4" value="2">(C)我怎么可能知道</div>
                <div><input type="radio" name="selectOne-4" value="3">(D)我知道才不对劲</div>
            </div>
            <div>
                <span>5.地球固态物理学有几种流派：</span>
                <div><input type="radio" name="selectOne-5" value="0">(A)我不知道</div>
                <div><input type="radio" name="selectOne-5" value="1">(B)我肯定不知道</div>
                <div><input type="radio" name="selectOne-5" value="2">(C)我怎么可能知道</div>
                <div><input type="radio" name="selectOne-5" value="3">(D)我知道才不对劲</div>
            </div>
            <input id="sureanswer" type="button" class="ui-button" value="提交">
        </div>
    </div>
</div>
</body>
<script>
    $(document).ready(function(){
        var classifyList;
        $(document).on('click', '#chooseTologgout', function () {
            $.ajax({
                url: "user/logout",
                type: "post",
                data: {},
                dataType: "json",
                async: false,
                success: function(data){
                    localStorage.removeItem("loginUser");
                    localStorage.removeItem("userid");
                    alert("退出登录成功！");
                    location.href="index.html";
                },
                error: function (error) {}
            });
            location.reload();
        });

        $("#name").val(localStorage.getItem("loginUser"));

        document.getElementById("uploadimage").onchange = function(){
            var file = this.files;
            var reader = new FileReader();
            reader.readAsDataURL(file[0]);
            reader.onload = function ()
            {
                var image = document.getElementById("showimage");
                image.src = reader.result;
            };
        }

        $(document).on('click', '#upload', function(){
            $("#uponeimage").show();
        });
        $(document).on('click', '#closeupload', function(){
            $("#uponeimage").hide();
        });
        $(document).on('click', '#sureupload', function(){
            if(localStorage.getItem("status") === '2'){
                var timenow = new Date();
                var formData = new FormData();
                var userid = localStorage.getItem("userid");
                var classifyid = $("#uploadclassify").val();
                var imagestring;
                formData.set("file", document.getElementById('uploadimage').files[0]);
                $.ajax({
                    url: "images/insertOneImageFile",
                    type: "post",
                    data: formData,
                    async: false,
                    cache: false,
                    processData: false,   // 不处理发送的数据
                    contentType: false,   // 不设置Content-Type请求头
                    success:function (data) {
                        $("#path").text(data);
                        console.log(data);
                    },
                    error: function(error){
                        imagestring = "";
                        alert("上传图片出错！");
                    }
                });
                $.ajax({
                    url: "images/insertOneImage",
                    type: "post",
                    data: {
                        userid: userid,
                        classifyid: classifyid,
                        uptime: timenow,
                        image: $("#path").text()
                    },
                    async: false,
                    success:function (data) {
                        alert("上传成功！等待管理员审核！");
                        $("#showimage").attr("src", "");
                        $("#path").text("");
                        $("#uponeimage").hide();
                    }
                });
            }
            else{
                alert("您没有权限上传图片！");
            }
        });

        $(document).on('click', '#answer', function(){
            $("#todoanswer").show();
        });
        $(document).on('click', '#closeanswer', function(){
            $("#todoanswer").hide();
        });
        $(document).on('click', '#sureanswer', function(){
            var pthis = $(this);
            var select_1 = pthis.parent().find("input[name='selectOne-1']");
            var select_1_cho;
            for(var i=0; i<4; i++){
                if(select_1[i].checked){
                    select_1_cho = select_1[i].value;
                    break;
                }
            }
            var select_2 = pthis.parent().find("input[name='selectOne-2']");
            var select_2_cho;
            for(var i=0; i<4; i++){
                if(select_2[i].checked){
                    select_2_cho = select_2[i].value;
                    break;
                }
            }
            var select_3 = pthis.parent().find("input[name='selectOne-3']");
            var select_3_cho;
            for(var i=0; i<4; i++){
                if(select_3[i].checked){
                    select_3_cho = select_3[i].value;
                    break;
                }
            }
            var select_4 = pthis.parent().find("input[name='selectOne-4']");
            var select_4_cho;
            for(var i=0; i<4; i++){
                if(select_4[i].checked){
                    select_4_cho = select_4[i].value;
                    break;
                }
            }
            var select_5 = pthis.parent().find("input[name='selectOne-5']");
            var select_5_cho;
            for(var i=0; i<4; i++){
                if(select_5[i].checked){
                    select_5_cho = select_5[i].value;
                    break;
                }
            }
            $.ajax({
                url: "user/doanswer",
                type: "post",
                data: {
                    userid: localStorage.getItem("userid"),
                    cho1: select_1_cho,
                    cho2: select_2_cho,
                    cho3: select_3_cho,
                    cho4: select_4_cho,
                    cho5: select_5_cho
                },
                dataType: "json",
                async: false,
                success: function(data){
                    if(data > 0) alert("答题通过！");
                    else if(data < 0) alert("答题提交出错！");
                    else alert("答题不通过！(小于80分)");
                },
                error(error){}
            });
        });

        $.ajax({
            url: "classify/getListClassify",
            type: "post",
            data: {},
            dataType: "json",
            async: false,
            success: function(data){
                classifyList = data;
                var selectedObj = $("#list");
                for(var i = 0; i < data.length; i++){
                    selectedObj.append("<input  type='button' class='ui-button' style='height: 100%;width: 13%;" +
                        "text-align: center;float: left' value='" + data[i].classifyname + "' id='classify_" +
                        data[i].classifyid + "'>");
                    $("#uploadclassify").append("<option value='" + data[i].classifyid + "'>" +
                        data[i].classifyname + "</option>");
                }
                if(localStorage.getItem("status")!==null && localStorage.getItem("status") === '0'){//登录账户为管理员
                    selectedObj.append("<input  type='button' class='ui-button' style='height: 100%;width: 26%;" +
                        "text-align: center;float: left' value='图片审核' id='shenhe'>");
                }
            },
            error: function(error){}
        });

        getAll();
        //访问图片元素获取链接
        function getAll() {
            $.ajax({
                url: "images/getImagesListAll",
                type: "post",
                data: {},
                dataType: "json",
                async: false,
                success: function (data) {
                    var selectedObj = $("#imageslist").empty();
                    if (data.length === 0) {
                        selectedObj.append("该模块暂无图片！");
                    }
                    for (var i = 0; i < data.length; i++) {
                        selectedObj.append("<div id='image_" + data[i].imageid + "'>" +
                            "发布者:<input type='button' class='un' value='" + data[i].username + "'>" +
                            "发布时间:<input class='ut' type='datetime' value='" + data[i].uptime + "' >" +
                            "<input class='zan' type='number' readonly value='" +data[i].zan + "'>" +
                            "<input type='button' class='ui-button zanbutton' value='赞'>" +
                            "<input class='cai' type='number' readonly value='" +data[i].cai + "'>" +
                            "<input type='button' class='ui-button caibutton' value='踩'><br>" +
                            "<img class='ig' style='width: 70%;height: auto' src='images/" + data[i].image + "' alt='图片'/><br>" +
                            "<div class='showcomment' style='width: 100%;height: auto;background-color: #CCC;border: 1px solid #000'>评论区</div><br>" +
                            "<textarea class='comment' style='width: 80%;height:100px;background-color: #FFF' placeholder='发表评论'></textarea><br>" +
                            "<button type='button' style='right: 5%;font-size: 26px;height: auto;width: auto' class='submitcomment'>发表</button><br>" +
                            "</div>");
                    }
                },
                error: function (error) {
                }
            });
        }

        $(document).on('click', '#classify_-1', function(){
           getAll();
        });

        //访问其他分类
        for(var i = 0; i < classifyList.length; i++){
            $(document).on('click', "#classify_" + classifyList[i].classifyid +"", function(){
                var pthis = $(this);
                $("#imageslist").empty();
                $("#imageslist").append("<input id='paihangbang' class='ui-button' type='button' value='"
                    + pthis.val() + " 排行榜'>");
                $.ajax({
                    url: "images/getImagesListByClassifyname",
                    type: "post",
                    data: {
                        classifyname: pthis.val()
                    },
                    dataType: "json",
                    async: false,
                    success: function (data) {
                        var selectedObj = $("#imageslist");
                        if (data.length === 0) {
                            selectedObj.append("该模块暂无图片！");
                        }
                        for (var i = 0; i < data.length; i++) {
                            selectedObj.append("<div id='image_" + data[i].imageid + "'>" +
                                "发布者:<input type='button' class='un' value='" + data[i].username + "'>" +
                                "发布时间:<input class='ut' type='datetime' value='" + data[i].uptime + "' >" +
                                "<input class='zan' type='number' readonly value='" +data[i].zan + "'>" +
                                "<input type='button' class='ui-button zanbutton' value='赞'>" +
                                "<input class='cai' type='number' readonly value='" +data[i].cai + "'>" +
                                "<input type='button' class='ui-button caibutton' value='踩'><br>" +
                                "<img class='ig' style='width: 70%;height: auto' src='images/" + data[i].image + "' alt='图片'/><br>" +
                                "<div class='showcomment' style='width: 100%;height: auto;background-color: #CCC;border: 1px solid #000'>评论区</div><br>" +
                                "<textarea class='comment' style='width: 80%;height:100px; background-color: #FFF' placeholder='发表评论'></textarea><br>" +
                                "<button type='button' style='right: 5%;font-size: 26px;height: auto;width: auto' class='submitcomment'>发表</button><br>" +
                                "</div>");
                        }
                    },
                    error: function (error) {
                    }
                });
            });
        }

        $(document).on('click', '#paihangbang', function(){
            var pthis = $(this);
            $("#imageslist").empty();
            $.ajax({
                url: "images/getImagesListByClassifynameAndZan",
                type: "post",
                data: {
                    classifyname: pthis.val().split(" ")[0]
                },
                dataType: "json",
                async: false,
                success: function (data) {
                    var selectedObj = $("#imageslist");
                    if (data.length === 0) {
                        selectedObj.append("该模块暂无图片！");
                    }
                    for (var i = 0; i < data.length; i++) {
                        selectedObj.append("<div id='image_" + data[i].imageid + "'>" +
                            "发布者:<input type='button' class='un' value='" + data[i].username + "'>" +
                            "发布时间:<input class='ut' type='datetime' value='" + data[i].uptime + "' >" +
                            "<input class='zan' type='number' readonly value='" +data[i].zan + "'>" +
                            "<input type='button' class='ui-button zanbutton' value='赞'>" +
                            "<input class='cai' type='number' readonly value='" +data[i].cai + "'>" +
                            "<input type='button' class='ui-button caibutton' value='踩'><br>" +
                            "<img class='ig' style='width: 70%;height: auto' src='images/" + data[i].image + "' alt='图片'/><br>" +
                            "<div class='showcomment' style='width: 100%;height: auto;background-color: #CCC;border: 1px solid #000'>评论区</div><br>" +
                            "<textarea class='comment' style='width: 80%;height:100px;background-color: #FFF' placeholder='发表评论'></textarea><br>" +
                            "<button type='button' style='right: 5%;font-size: 26px;height: auto;width: auto' class='submitcomment'>发表</button><br>" +
                            "</div>");
                    }
                },
                error: function (error) {
                }
            });
        });

        $(document).on('click', '.zanbutton', function(){
            var pthis = $(this);
            var imageid = pthis.parent().attr("id").split("_")[1];
            $.ajax({
                url: "images/setZanByImageid",
                type: "post",
                data: {
                    imageid: imageid
                },
                dataType: "json",
                async: false,
                success: function(data){
                    var nowzan = 0;
                    $.ajax({
                        url: "images/getZanByImageid",
                        type: "post",
                        data: {
                            imageid: imageid
                        },
                        dataType: "json",
                        async: false,
                        success: function(data){
                            nowzan = Number(data);
                        },
                        error: function(error){}
                    });
                    pthis.parent().find(".zan").val(nowzan);
                },
                error: function(error){}
            });
        });

        $(document).on('click', '.caibutton', function(){
            var pthis = $(this);
            var imageid = pthis.parent().attr("id").split("_")[1];
            $.ajax({
                url: "images/setCaiByImageid",
                type: "post",
                data: {
                    imageid: imageid
                },
                dataType: "json",
                async: false,
                success: function(data){
                    var nowcai = 0;
                    $.ajax({
                        url: "images/getCaiByImageid",
                        type: "post",
                        data: {
                            imageid: imageid
                        },
                        dataType: "json",
                        async: false,
                        success: function(data){
                            nowcai = Number(data);
                        },
                        error: function(error){}
                    });
                    pthis.parent().find(".cai").val(nowcai);
                },
                error: function(error){}
            });
        });

        $(document).on('click', '#shenhe', function() {
            $("#imageslist").empty();
            $.ajax({
                url: "images/getImagesListByNotshenhe",
                type: "post",
                data: {},
                dataType: "json",
                async: false,
                success: function (data) {
                    var selectedObj = $("#imageslist");
                    if (data.length === 0) {
                        selectedObj.append("暂无待审核图片！");
                    }
                    for (var i = 0; i < data.length; i++) {
                        selectedObj.append("<div id='image_" + data[i].imageid + "'>" +
                            "<input type='button' class='pass' value='通过'>" +
                            "上传者:<input type='button' class='un' value='" + data[i].username + "'>" +
                            "上传时间:<input class='ut' type='datetime' value='" + data[i].uptime + "' >" +
                            "所选分类:<input class='classify' type='text' value='" + data[i].classifyname + "'>" +
                            "<img class='ig' style='width: 70%;height: auto' src='images/" + data[i].image + "' alt='图片'/><br>" +
                            "</div>");
                    }
                },
                error: function (error) {
                }
            });
        });

        $(document).on('click', '.pass', function(){
            var pthis=$(this);
            var imageid = pthis.parent().attr("id").split("_")[pthis.parent().attr("id").split("_").length - 1];
            var classifyname = pthis.parent().find(".classify").val();
            $.ajax({
                url: "images/updatestatus",
                type: "post",
                data: {
                    imageid: imageid,
                    classifyname: classifyname
                },
                dataType: "json",
                async: false,
                success: function (data) {
                    alert("处理成功！");
                },
                error: function (error) {
                }
            });
        });

        //为加入的图片元素绑定评论显示事件
        $(document).on('click', '.showcomment', function(){
             var pthis = $(this);
            if(pthis.html() === "评论区") {
                var imageid = pthis.parent().attr("id").split("_")
                    [pthis.parent().attr("id").split("_").length - 1];
                //TODO 加入评论内容
                $.ajax({
                    url: "comments/getListCommentsByExcludeBlacklist",
                    type: "post",
                    data: {
                        imageid: imageid,
                        userid: localStorage.getItem("userid")
                    },
                    dataType: "json",
                    async: false,
                    success: function (data) {
                        for (var i = 0; i < data.length; i++) {
                            pthis.append("<br>" + data[i].nickname + ":(" + data[i].commenttime + ")<br><textarea style='width: 80%;height: 60px;'>" +
                                data[i].comment +
                                "</textarea><br>");
                        }
                    },
                    error: function (error) {
                    }
                });
            }
            else{
                pthis.html("评论区");
            }
        });

        //提交评论事件
        function canComment(commentuserid, imageusername){
            var res = false;
            $.ajax({
                url: "comments/canInsertOne",
                type: "post",
                data: {
                    commentuserid : commentuserid,
                    imageusername: imageusername
                },
                dataType: "json",
                async: false,
                success: function (data) {
                    if(data > 0) res = true;
                },
                error: function (error) {
                }
            });
            return res;
        }
        $(document).on('click', '.submitcomment', function (){
            var pthis = $(this);
            if(pthis.prev().prev().val() !== "" && localStorage.getItem("status") !== null && localStorage.getItem("status") === "2"
                && (canComment(localStorage.getItem("userid"), pthis.parent().find(".un").val()))){
                var commenttime = new Date();
                $.ajax({
                    url: "comments/insertOneComment",
                    type: "post",
                    data: {
                        commentuserid : localStorage.getItem("userid"),
                        imageid: pthis.parent().attr("id").split("_")
                            [pthis.parent().attr("id").split("_").length - 1],
                        commenttime: commenttime,
                        comment: pthis.prev().prev().val()
                    },
                    dataType: "json",
                    async: false,
                    success: function (data) {
                        alert("评论成功！");
                    },
                    error: function (error) {
                    }
                });
            }
            else{}
        });

        //点击发布者进入发布者的页面（展示其发布的内容）
        $(document).on('click', '.un', function(){
            var pthis = $(this);
            var imageid = pthis.parent().attr("id").split("_")[pthis.parent().attr("id").split("_").length - 1];
            var uptime = pthis.parent().find(".ut").val();
            var imagesrc = pthis.parent().find(".ig").attr("src");
            var imageusername = pthis.attr("value");
            localStorage.removeItem("nowimageusername");
            localStorage.removeItem("nowimageid");
            localStorage.removeItem("nowuptime");
            localStorage.removeItem("nowimagesrc");
            localStorage.setItem("nowimageusername", imageusername);
            localStorage.setItem("nowimageid", imageid);
            localStorage.setItem("nowuptime", uptime);
            localStorage.setItem("nowimagesrc", imagesrc);
            location.href = "./iFrame/player.html";
        });

        //通知栏
        var allnotice;
        var noticesNotread;
        var noticesReaded;
        $(document).on('click', '#notice', function(){
            $("#imageslist").empty();
            $("#imageslist").append("<input type='button' class='ui-button' style='text-align: center;" +
                "background-color: #cccccc' " +
                "value='全部消息' id='allnotice'>" +
                "<input type='button' class='ui-button' style='text-align: center' " +
                "value='已读消息' id='readed'>" +
                "<input type='button' class='ui-button' style='text-align: center' " +
                "value='未读消息' id='notread'><br>");
            $.ajax({
                url: "notices/getNoticeListByUseridAndNotRead",
                type: "post",
                data: {
                    userid: localStorage.getItem("userid")
                },
                dataType: "json",
                async: false,
                success: function(data){
                    noticesNotread = data;
                },
                error: function(error){
                    console.log(error);
                }
            });
            $.ajax({
                url: "notices/getNoticeListByUseridAndReaded",
                type: "post",
                data: {
                    userid: localStorage.getItem("userid")
                },
                dataType: "json",
                async: false,
                success: function(data){
                    noticesReaded = data;
                },
                error: function(error){
                    console.log(error);
                }
            });
            allnotice = noticesNotread.concat();
            allnotice = allnotice.concat(noticesReaded);
            for(var i=0; i<allnotice.length; i++){
                $("#imageslist").append("<div>" + allnotice[i].noticetime + ":" +
                    "<input type='button' class='ui-button sure' value='标记已读'>" +
                    "<input type='button' class='ui-button delete' value='删除'>" +
                    "↓<br><textarea " +
                    "id='notice_" + allnotice[i].noticeid + "'>" + allnotice[i].notice + "</textarea></div><br>");
            }
        });

        $(document).on('click', '#allnotice', function(){
            $("#imageslist").empty();
            $("#imageslist").append("" +
                "<input type='button' class='ui-button' value='全部消息' id='allnotice'>" +
                "<input type='button' class='ui-button' value='已读消息' id='readed'>" +
                "<input type='button' class='ui-button' value='未读消息' id='notread'><br>");
            for(var i=0; i<allnotice.length; i++){
                if(Number(allnotice[i].status) === 0){
                    $("#imageslist").append("<div>" + allnotice[i].noticetime + ":" +
                        "<input type='button' class='ui-button sure' value='标记已读'>" +
                        "<input type='button' class='ui-button delete' value='删除'>" +
                        "↓<br><textarea " +
                        "id='notice_" + allnotice[i].noticeid + "'>" + allnotice[i].notice + "</textarea></div><br>");
                }
                else{
                    $("#imageslist").append("<div>" + allnotice[i].noticetime + ":" +
                        "<input type='button' class='ui-button delete' value='删除'>" +
                        "↓<br><textarea " +
                        "id='notice_" + allnotice[i].noticeid + "'>" + allnotice[i].notice + "</textarea></div><br>");
                }
            }
        });
        $(document).on('click', '#readed', function(){
            $("#imageslist").empty();
            $("#imageslist").append("" +
                "<input type='button' class='ui-button' value='全部消息' id='allnotice'>" +
                "<input type='button' class='ui-button' value='已读消息' id='readed'>" +
                "<input type='button' class='ui-button' value='未读消息' id='notread'><br>");
            for(var i=0; i<noticesReaded.length; i++){
                $("#imageslist").append("<div>" + noticesReaded[i].noticetime + ":" +
                    "<input type='button' class='ui-button delete' value='删除'>" +
                    "↓<br><textarea " +
                    "id='notice_" + noticesReaded[i].noticeid + "'>" + noticesReaded[i].notice + "</textarea></div><br>");
            }
        });
        $(document).on('click', '#notread', function(){
            $("#imageslist").empty();
            $("#imageslist").append("" +
                "<input type='button' class='ui-button' value='全部消息' id='allnotice'>" +
                "<input type='button' class='ui-button' value='已读消息' id='readed'>" +
                "<input type='button' class='ui-button' value='未读消息' id='notread'><br>");
            for(var i=0; i<noticesNotread.length; i++){
                $("#imageslist").append("<div>" + noticesNotread[i].noticetime + ":" +
                    "<input type='button' class='ui-button sure' value='标记已读'>" +
                    "↓<br><textarea " +
                    "id='notice_" + noticesNotread[i].noticeid + "'>" + noticesNotread[i].notice + "</textarea></div><br>");
            }
        });

        $(document).on('click', '.sure', function(){
            var pthis = $(this);
            var noticeid = pthis.parent().find("textarea").attr("id").split("_")
                [pthis.parent().find("textarea").attr("id").split("_").length - 1];
            $.ajax({
                url: "notices/updateStatus",
                type: "post",
                data: {
                    userid: localStorage.getItem("userid"),
                    noticeid: noticeid
                },
                dataType: "json",
                async: false,
                success: function(data){
                    pthis.parent().remove();
                    $.ajax({
                        url: "notices/getNoticeListByUseridAndNotRead",
                        type: "post",
                        data: {
                            userid: localStorage.getItem("userid")
                        },
                        dataType: "json",
                        async: false,
                        success: function(data){
                            noticesNotread = data;
                        },
                        error: function(error){
                            console.log(error);
                        }
                    });
                    $.ajax({
                        url: "notices/getNoticeListByUseridAndReaded",
                        type: "post",
                        data: {
                            userid: localStorage.getItem("userid")
                        },
                        dataType: "json",
                        async: false,
                        success: function(data){
                            noticesReaded = data;
                        },
                        error: function(error){
                            console.log(error);
                        }
                    });
                },
                error: function(error){console.log(error)}
            });
        });

        $(document).on('click', '.delete', function(){
            var pthis = $(this);
            var noticeid = pthis.parent().find("textarea").attr("id").split("_")
                [pthis.parent().find("textarea").attr("id").split("_").length - 1];
            $.ajax({
                url: "notices/deleteOneNotice",
                type: "post",
                data: {
                    userid: localStorage.getItem("userid"),
                    noticeid: noticeid
                },
                dataType: "json",
                async: false,
                success: function(data){
                    pthis.parent().remove();
                    $.ajax({
                        url: "notices/getNoticeListByUseridAndNotRead",
                        type: "post",
                        data: {
                            userid: localStorage.getItem("userid")
                        },
                        dataType: "json",
                        async: false,
                        success: function(data){
                            noticesNotread = data;
                        },
                        error: function(error){
                            console.log(error);
                        }
                    });
                    $.ajax({
                        url: "notices/getNoticeListByUseridAndReaded",
                        type: "post",
                        data: {
                            userid: localStorage.getItem("userid")
                        },
                        dataType: "json",
                        async: false,
                        success: function(data){
                            noticesReaded = data;
                        },
                        error: function(error){
                            console.log(error);
                        }
                    });
                    allnotice = noticesNotread.concat();
                    allnotice = allnotice.concat(noticesReaded);
                },
                error: function(error){console.log(error)}
            });
        });
    });
</script>
</html>